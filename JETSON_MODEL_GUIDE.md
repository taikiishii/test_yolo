# Jetson Orin Nano - YOLO 推奨モデルガイド

## ✅ 動作確認完了

全ての修正が完了し、正常に動作しています：
- ✅ PyTorch 2.7.0 + CUDA 12.6
- ✅ ヘッドレスモード（ディスプレイなし）対応
- ✅ GPUメモリ不足時の自動CPUフォールバック
- ✅ 検出オブジェクト名のコンソール出力
- ✅ Enterキーで推奨モデル自動選択
- ✅ 'r'キーでプログラム再起動（GPU状態リセット）

## 🚀 クイックスタート

```bash
cd /home/taiki/Documents/test_yolo
source .venv/bin/activate
python webcam_detection_improved.py
```

**起動時:**
- **推奨**: Enterキーを押すだけ → yolo11n.pt が自動選択されます
- または、17 を入力 (yolo11n.pt) / 1 を入力 (yolov8n.pt)

## 🚀 Jetson Orin Nano 推奨モデル

### 最高速・推奨 ⭐
- **yolo11n.pt** (YOLO11 Nano) - 2.6M パラメータ
  - GPU: ~30-40 FPS
  - 精度: 良好
  - メモリ: 非常に少ない
  - **Enterキーで自動選択可能**

- **yolov8n.pt** (YOLOv8 Nano) - 3.2M パラメータ
  - GPU: ~30-40 FPS
  - 精度: 良好
  - メモリ: 非常に少ない

### バランス型
- **yolo11s.pt** (YOLO11 Small)
  - GPU: ~20-30 FPS
  - 精度: より高精度
  - メモリ: 少ない

- **yolov8s.pt** (YOLOv8 Small)
  - GPU: ~20-30 FPS
  - 精度: より高精度
  - メモリ: 少ない

### ⚠️ 非推奨（メモリ不足の可能性）
- **yolo11l.pt, yolo11x.pt** - GPUメモリ不足により自動的にCPUモードにフォールバック
  - CPU: ~0.3-1 FPS（非常に遅い）

## 実行方法

```bash
cd /home/taiki/Documents/test_yolo
source .venv/bin/activate
python webcam_detection_improved.py
```

起動時にモデルを選択してください：
- **推奨**: Enterキーのみ（yolo11n.pt が自動選択）
- または: 17 (yolo11n.pt) または 1 (yolov8n.pt)

## パフォーマンス実測値

| モデル | パラメータ | GPU FPS | CPU FPS | メモリ | 動作状況 |
|--------|-----------|---------|---------|--------|----------|
| yolo11n | 2.6M | ~30-40 | ~2-4 | 低 | ✅ 推奨 |
| yolov8n | 3.2M | ~30-40 | ~2-4 | 低 | ✅ 推奨 |
| yolo11s | - | ~20-30 | ~1-2 | 中 | ⚠️ 要注意 |
| yolo11x | 56.9M | ❌ | ~0.3-1 | 極高 | ❌ 非推奨 |

## キーボード操作（実行中）

- **q**: 終了
- **r**: プログラムを再起動（GPU状態をリセット）⭐ 新機能
- **m**: モデル変更
- **c/x**: 信頼度調整
- **s**: 画像サイズ切替（320/416/480/640）
  - 320px: 最速（推奨）
  - 640px: 高精度だが低速
- **f**: フレームスキップ切替

## トラブルシューティング

### GPUメモリ不足エラー → CPUフォールバック
```
⚠ GPUメモリ不足エラー: NVML_SUCCESS == r INTERNAL ASSERT FAILED
→ CPUモードに切り替えます...
✓ CPUモードに切り替えました
```

**対処法（3つの方法）:**

#### 1. **推奨: 'r'キーでプログラム再起動** ⭐
実行中に`r`キーを押すと、プログラムが再起動されGPU状態が完全にリセットされます。
再起動後、小さいモデル（yolo11n または yolov8n）を選択してください。

#### 2. モデル変更 (制限あり)
実行中に`m`キーを押して小さいモデルに変更できますが、以下の制限があります：
- ⚠️ 一度GPUメモリ不足が発生すると、Jetson環境ではGPU状態が不安定になる場合があります
- メモリ解放を試みますが、完全にはクリアされない可能性があります
- GPUに戻れない場合は、下記のメッセージが表示されます：
  ```
  ⚠ 注意: GPUメモリの状態が不安定なため、CPUモードで動作しています
  → GPUを使用するには、プログラムを再起動してください
  ```

#### 3. プログラムを完全に終了して再起動
`q`キーで終了後、再度プログラムを起動してください。

### モデル変更時の動作

**GPUメモリ不足後にGPUに戻す方法:**

1. **'r'キーで再起動（最も確実）**
   ```
   実行中に 'r' を押す
   → プログラムが自動的に再起動
   → GPUメモリが完全にリセット
   → 小さいモデルを選択
   ```

2. **プログラムを終了して再起動**
   ```
   'q'キーで終了
   → python webcam_detection_improved.py
   → 小さいモデルを選択
   ```

### ヘッドレスモード（ディスプレイなし）
```
⚠ DISPLAYが設定されていません - ヘッドレスモードで動作します
⚠ ディスプレイなし環境 - GUI表示スキップ
  検出結果をコンソールに出力します
```

**これは正常です**。検出結果はコンソールに出力されます：
```
FPS: 30.38 | Detected: 1 objects (person)
```

## 検出結果の見方

コンソール出力例：
```
FPS: 30.38 | Detected: 2 objects (person, car)
FPS: 28.52 | Detected: 1 objects (dog)
FPS: 31.15 | Detected: 0 objects
```

- **FPS**: フレームレート（高いほど滑らか）
- **Detected**: 検出されたオブジェクト数
- **括弧内**: 検出されたオブジェクトの名前（カンマ区切り）

## 💡 ベストプラクティス

1. **起動時**: Enterキーで推奨モデルを自動選択
2. **大きいモデルを試したい場合**: 警告メッセージに注意
3. **GPUメモリ不足が発生したら**: `r`キーで即座に再起動
4. **最高のパフォーマンス**: yolo11n.pt + 画像サイズ 320px
